from pwn import *
import base64
import warnings

warnings.simplefilter("ignore", category=BytesWarning)
context.update(os = "linux", arch = "amd64")

p = remote("chall.glacierctf.com", 13371)

# do PoW
p.recvuntil(b"work:")
PoW = p.recvuntil(b"stamp:", drop = True).strip()
hashcash = process(PoW.split())
hashcash.recvuntil(b"token:")
token = hashcash.recvuntil(b"\n").strip()
p.sendline(token)

p.recvuntil("exploit.c:")
with open("sweb/userspace/tests/exploit.c", "rb") as exploit_file:	# the actual exploit file
	exploit_src = exploit_file.read()
payload = base64.b64encode(exploit_src)
log.info("payload = " + repr(payload))
p.sendline(payload)

p.interactive()

